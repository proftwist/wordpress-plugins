# Пояснительная записка к плагину Easy Changelog

## Описание проекта

Плагин Easy Changelog представляет собой WordPress блок для отображения истории изменений (changelog) с интуитивным редактором JSON и встроенным предпросмотром.

## Обновления версии 1.2.1

### Критические исправления
- **Исправление отображения fixed элементов в предпросмотре** - Теперь fixed элементы корректно отображаются в редакторе Гутенберга
- **Улучшена функция renderList** - Добавлена проверка на пустые массивы для предотвращения создания пустых HTML элементов
- **Обновлен текст подсказки** - Добавлено упоминание поддержки fixed в помощи редактора
- **Упрощена логика рендеринга** - Улучшена производительность и читаемость кода

## Обновления версии 1.2.0

### Ключевые улучшения
- **Исправление стилей для редактора Гутенберга** - Улучшена совместимость и отображение в редакторе блоков
- **Поддержка тега `fixed`** - Добавлена возможность отображения исправлений с синими маркерами
- **Улучшенная визуализация предпросмотра** - Предпросмотр теперь точно соответствует фронтенду
- **Разделение типов изменений** - Зеленые маркеры для `added`, синие для `fixed`
- **Поддержка темной темы** - Специальные стили для темного режима редактора
- **Улучшенная адаптивность** - Оптимизация для мобильных устройств
- **Анимации и переходы** - Плавные анимации для улучшения пользовательского опыта
- **Поддержка accessibility** - Высокая контрастность и уменьшение движения

## Техническая реализация

### Архитектура
- **Базовый язык**: PHP 7.4+
- **Frontend**: React 18+ с использованием @wordpress/components
- **Сборка**: WordPress Scripts (@wordpress/scripts)
- **Стили**: SCSS с автопрефиксером и PostCSS
- **Локализация**: WordPress i18n с поддержкой русского и английского языков

### Компоненты системы

#### 1. Основной PHP класс (easy-changelog.php)
- Регистрация Gutenberg блока
- Рендеринг блока на фронтенде с поддержкой `fixed`
- Подключение локализации
- Добавление категории блоков
- Обновленный default JSON с примерами `fixed`

#### 2. React компоненты (src/)
- **index.js**: Регистрация блока с атрибутами и обновленным default JSON
- **edit.js**: Интерфейс редактирования с вкладками и поддержкой `fixed`
- **style.scss**: Переработанные стили для редактора и фронтенда

#### 3. Система локализации (languages/)
- **easy-changelog-ru_RU.po**: Русская локализация
- **easy-changelog-en_US.po**: Английская локализация

## Ключевые особенности

### Функциональность редактора
- Двухвкладочный интерфейс: "Редактор JSON" и "Предпросмотр"
- Валидация JSON в реальном времени
- Автоматическое обновление предпросмотра
- Обработка ошибок с понятными сообщениями
- **Новая поддержка тега `fixed` для отображения исправлений**

### Безопасность
- Экранирование всех выводимых данных (esc_html)
- Валидация JSON данных перед рендерингом
- Проверка наличия Gutenberg перед регистрацией блока

### Производительность
- Ленивая загрузка фронтенд стилей
- Минимальное количество зависимостей
- Оптимизированная сборка через WordPress Scripts

## Технологический стек

### Зависимости времени выполнения
```json
{
  "@wordpress/blocks": "^12.0.0",
  "@wordpress/block-editor": "^11.0.0",
  "@wordpress/components": "^23.0.0",
  "@wordpress/element": "^5.0.0",
  "@wordpress/i18n": "^4.0.0"
}
```

### Зависимости разработки
```json
{
  "@wordpress/scripts": "^25.0.0",
  "sass": "^1.69.0"
}
```

## Структура данных

### Формат JSON для changelog
```json
[
  {
    "version": "1.0.0",
    "date": "19.11.2025",
    "added": ["Первоначальный релиз плагина", "Базовая функциональность блоков"],
    "fixed": ["Исправлена ошибка валидации JSON", "Улучшена обработка дат"]
  }
]
```

### Поддерживаемые поля
- **version**: Версия релиза (строка)
- **date**: Дата релиза (строка)
- **added**: Массив добавленных функций (array of strings) - зеленые маркеры
- **fixed**: Массив исправлений (array of strings) - синие маркеры

## Обновленные стили

### Новые CSS классы
- `.easy-changelog-added` - список добавленных функций (зеленые маркеры)
- `.easy-changelog-fixed` - список исправлений (синие маркеры)
- `.easy-changelog-item` - отдельный элемент списка
- `.easy-changelog-item-added` - элемент добавленной функции
- `.easy-changelog-item-fixed` - элемент исправления
- `.easy-changelog-preview` - предпросмотр в редакторе

### Специальные возможности стилей
- Поддержка темной темы через `.wp-block-dark`
- Высокая контрастность через `prefers-contrast: high`
- Уменьшение движения через `prefers-reduced-motion: reduce`
- Адаптивность для мобильных устройств
- Плавные анимации и переходы
- Специальные стили для редактора Гутенберга

## Процесс сборки

### Команды разработки
```bash
# Компиляция SCSS в CSS
npx sass src/style.scss build/style-index.css

# Сборка блока (если используется WordPress Scripts)
npm run build
```

## Совместимость

### Системные требования
- WordPress 5.8+
- PHP 7.4+
- Node.js 14+ (для разработки)

### Поддерживаемые браузеры
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## Локализация

### Поддерживаемые языки
- **Русский** (ru_RU) - по умолчанию
- **Английский** (en_US)

### Структура переводов
Все текстовые строки обернуты в функции `__()` и поддерживают:
- Контекст перевода ('easy-changelog')
- Множественные формы для русского языка
- Fallback на английский при отсутствии перевода

## Безопасность

### Меры защиты
- Все пользовательские данные экранируются
- JSON валидируется перед обработкой
- Проверка прав доступа (проверяется в WordPress)
- Защита от XSS через esc_html()

### Валидация данных
- Проверка JSON синтаксиса
- Убеждение что данные являются массивом
- Проверка наличия обязательных полей
- Graceful fallbacks при ошибках

## Развертывание

### Установка в production
1. Скопировать папку плагина в `/wp-content/plugins/`
2. Активировать через админ-панель WordPress
3. При необходимости скопировать собранные файлы из build/

### Рекомендуемая структура production
```
wp-content/plugins/easy-changelog/
├── easy-changelog.php
├── package.json (не обязательно)
├── build/
│   ├── index.js
│   ├── index.asset.php
│   └── style-index.css
├── src/ (не обязательно в production)
└── languages/
    ├── easy-changelog-ru_RU.mo
    ├── easy-changelog-ru_RU.json
    ├── easy-changelog-en_US.mo
    └── easy-changelog-en_US.json
```

## Возможности расширения

### Реализованные улучшения
- ✅ Поддержка тега `fixed` для отображения исправлений
- ✅ Улучшенные стили для редактора Гутенберга
- ✅ Разделение типов изменений по цветам
- ✅ Поддержка темной темы

### Потенциальные улучшения
- Поддержка других типов изменений (deprecated, removed, security)
- Импорт из GitHub/GitLab
- Шаблоны для различных форматов changelog
- Экспорт в различные форматы
- Интеграция с системами CI/CD

### API для разработчиков
Блок предоставляет чистый HTML output и может быть кастомизирован через CSS. Структура классов:
- `.easy-changelog-block` - основной контейнер
- `.easy-changelog-release` - контейнер релиза
- `.easy-changelog-version` - версия
- `.easy-changelog-date` - дата
- `.easy-changelog-content` - контент релиза
- `.easy-changelog-added` - список добавленных функций (зеленые маркеры)
- `.easy-changelog-fixed` - список исправлений (синие маркеры)

## Поддержка и документация

### Документация для пользователей
- Подробные инструкции по использованию в README.md
- Примеры JSON структур с поддержкой `fixed`
- Советы по форматированию changelog

### Техническая поддержка
- Автор: Владимир Бычко (http://bychko.ru)
- Лицензия: GPL v2 или более поздняя
- Версия: 1.2.0

### История версий
- **1.2.0** - Исправление стилей редактора, добавлена поддержка `fixed`
- **1.1.0** - Первоначальный релиз с базовой функциональностью

---

*Плагин разработан с соблюдением стандартов WordPress Codex и лучших практик безопасности.*