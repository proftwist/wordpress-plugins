(()=>{"use strict";var e,a={51:(e,a,n)=>{const t=window.wp.blocks,l=window.wp.i18n,r=window.React,s=window.wp.element,o=window.wp.blockEditor,c=window.wp.components,g=window.wp.apiFetch;var i=n.n(g);const d=window.easyChangelogI18n||{},h=window.easyChangelogI18n||{};(0,t.registerBlockType)("easy-changelog/changelog",{title:h.title||(0,l.__)("Easy Changelog","easy-changelog"),description:h.description||(0,l.__)("Блок для отображения changelog с редактором JSON и предпросмотром","easy-changelog"),category:"easy-changelog",icon:"list-view",supports:{html:!1},attributes:{changelogData:{type:"string",default:'[\n  {\n    "version": "1.0.0",\n    "date": "19.11.2025",\n    "added": ["Первоначальный релиз плагина", "Базовая функциональность блоков"],\n    "fixed": ["Исправлена ошибка валидации JSON", "Улучшена обработка дат"]\n  },\n  {\n    "version": "0.9.0", \n    "date": "15.11.2025",\n    "added": ["Бета-версия плагина", "Тестирование функциональности"],\n    "fixed": ["Устранены проблемы с локализацией"]\n  }\n]'},jsonUrl:{type:"string",default:""},useExternalUrl:{type:"boolean",default:!1}},edit:({attributes:e,setAttributes:a})=>{const{changelogData:n,jsonUrl:t,useExternalUrl:g}=e,[h,m]=(0,s.useState)([]),[y,u]=(0,s.useState)(""),[p,v]=(0,s.useState)(""),[_,E]=(0,s.useState)("");(0,s.useEffect)(()=>{try{const e=JSON.parse(n);Array.isArray(e)?(m(e),u("")):u(d.mustBeArray||(0,l.__)("Данные должны быть массивом","easy-changelog"))}catch(e){u(d.invalidJson||(0,l.__)("Некорректный JSON формат","easy-changelog"))}},[n]);const f=[{name:"editor",title:d.jsonEditor||(0,l.__)("Редактор JSON","easy-changelog")},{name:"external",title:d.externalJson||(0,l.__)("Внешний JSON","easy-changelog")},{name:"preview",title:d.preview||(0,l.__)("Предпросмотр","easy-changelog")}],b=async()=>{if(!t)return v("error"),void E((0,l.__)("Введите URL для загрузки","easy-changelog"));v("loading"),E("");try{const e=await i()({path:"/easy-changelog/v1/fetch-external",method:"POST",data:{url:t}});e.success&&e.data?(a({changelogData:JSON.stringify(e.data,null,2),useExternalUrl:!0}),v("success"),E(d.fetchSuccess||(0,l.__)("Данные успешно загружены","easy-changelog"))):(v("error"),E(e.message||d.fetchError||(0,l.__)("Ошибка загрузки внешнего JSON","easy-changelog")))}catch(e){v("error"),E(e.message||d.fetchError||(0,l.__)("Ошибка загрузки внешнего JSON","easy-changelog"))}},w=(e,a="added")=>Array.isArray(e)&&0!==e.length?(0,r.createElement)("ul",{className:`easy-changelog-${a}`},e.map((e,n)=>(0,r.createElement)("li",{key:n,className:`easy-changelog-item easy-changelog-item-${a}`},e))):null;return(0,r.createElement)("div",{...(0,o.useBlockProps)()},(0,r.createElement)(c.TabPanel,{className:"easy-changelog-tabs",tabs:f},e=>(0,r.createElement)("div",{className:"easy-changelog-tab-content"},"editor"===e.name&&(0,r.createElement)("div",null,(0,r.createElement)(c.TextareaControl,{label:d.changelogData||(0,l.__)("Данные Changelog (JSON)","easy-changelog"),value:n,onChange:e=>a({changelogData:e}),rows:15,help:d.jsonHelp||(0,l.__)("Введите данные в формате JSON. Каждый релиз должен содержать version, date, added и fixed.","easy-changelog")}),y&&(0,r.createElement)("div",{style:{color:"#cc1818",marginTop:"10px"}},d.error||(0,l.__)("Ошибка:","easy-changelog")," ",y)),"external"===e.name&&(0,r.createElement)("div",null,(0,r.createElement)(c.ToggleControl,{label:(0,l.__)("Использовать внешний JSON","easy-changelog"),checked:g,onChange:e=>a({useExternalUrl:e})}),g&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)(c.TextControl,{label:d.jsonUrl||(0,l.__)("URL внешнего JSON файла","easy-changelog"),value:t,onChange:e=>a({jsonUrl:e}),help:d.urlHelp||(0,l.__)("Укажите прямую ссылку на JSON файл в GitHub или другом хранилище","easy-changelog")}),(0,r.createElement)("div",{style:{margin:"15px 0"}},(0,r.createElement)(c.Button,{variant:"primary",onClick:b,isBusy:"loading"===p,disabled:!t||"loading"===p},d.loadFromUrl||(0,l.__)("Загрузить из URL","easy-changelog"))),"success"===p&&(0,r.createElement)(c.Notice,{status:"success",isDismissible:!1},_),"error"===p&&(0,r.createElement)(c.Notice,{status:"error",isDismissible:!1},_),(0,r.createElement)("div",{style:{background:"#f6f7f7",padding:"15px",borderRadius:"4px",marginTop:"15px",fontSize:"13px"}},(0,r.createElement)("strong",null,d.githubHelp||(0,l.__)("Как получить ссылку на GitHub:","easy-changelog")),(0,r.createElement)("p",{style:{margin:"8px 0"}},d.githubInstructions||(0,l.__)('1. Перейдите в репозиторий на GitHub → 2. Выберите ветку → 3. Найдите файл → 4. Нажмите "Raw" → 5. Скопируйте URL из адресной строки',"easy-changelog")),(0,r.createElement)("p",{style:{margin:"8px 0",fontFamily:"monospace",background:"#fff",padding:"5px",borderRadius:"3px"}},d.exampleUrl||(0,l.__)("Пример: https://raw.githubusercontent.com/username/repo/main/changelog.json","easy-changelog"))))),"preview"===e.name&&(0,r.createElement)("div",{className:"easy-changelog-block easy-changelog-preview"},y?(0,r.createElement)("div",{style:{color:"#cc1818"}},d.cannotPreview||(0,l.__)("Невозможно отобразить предпросмотр из-за ошибок в JSON","easy-changelog")):(0,r.createElement)(r.Fragment,null,(0,r.createElement)("h2",{className:"easy-changelog-title"},d.changelogTitle||(0,l.__)("История изменений","easy-changelog")),h.map((e,a)=>(0,r.createElement)("div",{key:a,className:"easy-changelog-release"},(0,r.createElement)("div",{className:"easy-changelog-version"},(0,r.createElement)("strong",null,e.version)),(0,r.createElement)("div",{className:"easy-changelog-date"},e.date),(0,r.createElement)("div",{className:"easy-changelog-content"},w(e.added,"added"),w(e.fixed,"fixed")))))))))},save:()=>null})}},n={};function t(e){var l=n[e];if(void 0!==l)return l.exports;var r=n[e]={exports:{}};return a[e](r,r.exports,t),r.exports}t.m=a,e=[],t.O=(a,n,l,r)=>{if(!n){var s=1/0;for(i=0;i<e.length;i++){for(var[n,l,r]=e[i],o=!0,c=0;c<n.length;c++)(!1&r||s>=r)&&Object.keys(t.O).every(e=>t.O[e](n[c]))?n.splice(c--,1):(o=!1,r<s&&(s=r));if(o){e.splice(i--,1);var g=l();void 0!==g&&(a=g)}}return a}r=r||0;for(var i=e.length;i>0&&e[i-1][2]>r;i--)e[i]=e[i-1];e[i]=[n,l,r]},t.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},t.d=(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={57:0,350:0};t.O.j=a=>0===e[a];var a=(a,n)=>{var l,r,[s,o,c]=n,g=0;if(s.some(a=>0!==e[a])){for(l in o)t.o(o,l)&&(t.m[l]=o[l]);if(c)var i=c(t)}for(a&&a(n);g<s.length;g++)r=s[g],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(i)},n=globalThis.webpackChunkeasy_changelog=globalThis.webpackChunkeasy_changelog||[];n.forEach(a.bind(null,0)),n.push=a.bind(null,n.push.bind(n))})();var l=t.O(void 0,[350],()=>t(51));l=t.O(l)})();