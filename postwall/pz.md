# Плагин Post Wall - Кафельная стенка постов

## Описание

**Post Wall** - это WordPress плагин, который отображает статистику публикаций постов в виде интерактивной тепловой карты (heatmap) за последние 12 месяцев. Плагин позволяет визуализировать активность публикаций на любом WordPress сайте через REST API.

## Основные возможности

### Gutenberg-блок
- Вставка блока в любой пост или страницу через редактор Gutenberg
- Настройка URL сайта для анализа
- Выбор тега заголовка (H2, H3, H4 или обычный текст)
- Автоматическая генерация тепловой карты публикаций

### Шорткод
- Возможность использования шорткода `[postwall site_url="https://example.com"]`
- Гибкая интеграция в любую часть сайта

### Интерактивность
- Клик по дням с постами открывает архивную страницу даты
- Подсказки с количеством постов за день
- Поддержка локализации (русский/английский)

## Техническая архитектура

### Структура файлов
```
/postwall/
├── postwall.php                 # Основной файл плагина
├── assets/
│   ├── css/frontend.css         # Стили для фронтенда
│   └── js/frontend.js           # JavaScript логика
├── build/                       # Скомпилированные ресурсы
├── includes/
│   ├── class-ajax-handler.php   # Обработка AJAX запросов
│   ├── class-assets-manager.php # Управление ресурсами
│   ├── class-postwall-api.php   # API для получения данных
│   └── block-registration.php   # Регистрация Gutenberg-блока
└── languages/                   # Файлы локализации
```

### Ключевые классы

#### PostWall (postwall.php)
Основной класс плагина, отвечающий за:
- Инициализацию плагина
- Регистрацию хуков WordPress
- Подключение ресурсов

#### PostWall_Ajax_Handler (includes/class-ajax-handler.php)
Обрабатывает AJAX запросы для получения данных о постах:
- Проверка безопасности (nonce)
- Валидация входных данных
- Передача данных в формате JSON

#### PostWall_API (includes/class-postwall-api.php)
Работает с WordPress REST API внешних сайтов:
- Получение списка постов через `/wp-json/wp/v2/posts`
- Кеширование данных (1 час)
- Обработка ошибок API

#### PostWall_Assets_Manager (includes/class-assets-manager.php)
Управляет загрузкой CSS и JavaScript ресурсов:
- Подключение стилей и скриптов
- Версионирование на основе времени изменения файлов

## Как работает

1. **Вставка блока**: Пользователь добавляет Gutenberg-блок и указывает URL сайта
2. **AJAX запрос**: Фронтенд отправляет запрос на получение данных о постах
3. **API вызов**: Сервер обращается к REST API указанного сайта
4. **Обработка данных**: Полученные посты группируются по дням за последние 12 месяцев
5. **Визуализация**: Данные отображаются в виде тепловой карты с цветовой индикацией активности

## Цветовая схема

- **Нет постов**: Серый цвет (уровень 0)
- **1 пост**: Светло-зеленый (уровень 1)
- **2 поста**: Зеленый (уровень 2)
- **3-4 поста**: Темно-зеленый (уровень 3)
- **5+ постов**: Самый насыщенный цвет (уровень 4)

## Локализация

Плагин поддерживает полную локализацию:
- Русский язык (ru_RU)
- Английский язык (en_US)
- Правильное склонение слов для русского языка
- Перевод месяцев и интерфейсных элементов

## Системные требования

- WordPress 5.0+
- PHP 7.0+
- Поддержка REST API на анализируемом сайте
- JavaScript включен в браузере

## Безопасность

- Проверка nonce для всех AJAX запросов
- Санитизация входных данных
- Безопасная обработка URL
- Защита от прямого доступа к файлам

## Производительность

- Кеширование данных на 1 час
- Оптимизированная загрузка ресурсов
- Минифицированные JavaScript и CSS файлы
- Ленивая загрузка данных

## Использование

### Gutenberg-блок
1. Откройте редактор Gutenberg
2. Найдите блок "Post Wall"
3. Укажите URL сайта в настройках блока
4. Выберите желаемый тег заголовка (H2, H3, H4 или обычный текст)
5. Опубликуйте страницу

### Шорткод
```
[postwall site_url="https://example.com"]
```

## API ответ

Плагин возвращает данные в формате JSON с датами и количеством постов:

```json
{
    "2023-01-01": 2,
    "2023-01-02": 0,
    "2023-01-03": 5
}
```

## История версий

### 2.1.1 (текущая)
- Добавлена возможность выбора тега заголовка в Gutenberg-блоке (H2, H3, H4, обычный текст)
- Исправлена локализация - теперь переводы правильно работают в Gutenberg редакторе и на фронтенде
- Обновлена документация

### 2.1.0
- Убрана вся отладочная логировка
- Добавлены подробные русские комментарии
- Код оптимизирован и приведен к современным стандартам
- Обновлена документация

### 1.0.0
- Первая стабильная версия
- Базовый функционал тепловой карты постов
- Поддержка Gutenberg и шорткодов

## Разработка

Для разработки плагина требуются:
- Node.js для сборки ресурсов
- WordPress Coding Standards
- PHPDoc для документации

## Лицензия

Плагин распространяется под лицензией GPL v2 или выше.

## Автор

**Владимир Бычко**
- Website: [bychko.ru](https://bychko.ru)

## Поддержка

Для вопросов и предложений используйте:
- Репозиторий на GitHub. Создавайте Issues.