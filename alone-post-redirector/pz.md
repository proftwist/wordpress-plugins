# Плагин Alone Post Redirector - Перенаправление на одиночный пост

## Описание

**Alone Post Redirector** - это WordPress плагин, который автоматически перенаправляет пользователей на страницу одиночного поста, когда в архивах категорий, тегов или дат присутствует только один пост. Плагин улучшает пользовательский опыт, устраняя ненужный промежуточный шаг в навигации.

## Основные возможности

### Автоматическое перенаправление
- Перенаправление для архивов категорий с одним постом
- Перенаправление для архивов тегов с одним постом
- Перенаправление для архивов дат с одним постом
- Настраиваемые параметры включения/отключения для каждого типа архива

### Админ-панель управления
- Простой интерфейс настроек в WordPress Admin
- Чекбоксы для включения/отключения перенаправлений
- Интуитивно понятные метки и описания

### Локализация
- Полная поддержка многоязычности
- Файлы переводов (.po/.mo) для разных языков
- Перевод интерфейса админ-панели

## Техническая архитектура

### Структура файлов
```
/alone-post-redirector/
├── alone-post-redirector.php    # Основной файл плагина
└── languages/                   # Файлы локализации
    ├── alone-post-redirector.pot
    ├── alone-post-redirector-ru_RU.po
    ├── alone-post-redirector-ru_RU.mo
    ├── alone-post-redirector-en_US.po
    └── alone-post-redirector-en_US.mo
```

### Ключевой класс

#### AlonePostRedirector
Основной класс плагина, отвечающий за всю функциональность:
- Инициализация плагина и подключение хуков
- Загрузка домена переводов
- Регистрация настроек через Settings API
- Добавление страницы настроек в админ-меню
- Проверка и выполнение перенаправления

##### Методы класса
- `__construct()` - инициализация и подключение хуков
- `load_textdomain()` - загрузка файлов локализации
- `register_settings()` - регистрация настроек плагина
- `settings_section_callback()` - вывод описания секции настроек
- `redirect_categories_callback()` - чекбокс для категорий
- `redirect_tags_callback()` - чекбокс для тегов
- `redirect_dates_callback()` - чекбокс для дат
- `add_admin_menu()` - добавление страницы в админ-меню
- `options_page()` - вывод страницы настроек
- `check_redirect()` - основная логика перенаправления

## Как работает

1. **Инициализация**: Плагин подключается к хукам WordPress при активации
2. **Загрузка переводов**: Загружаются файлы локализации для текущего языка
3. **Регистрация настроек**: Создаются опции для управления поведением плагина
4. **Проверка перенаправления**: На хуке `template_redirect` проверяется необходимость перенаправления
5. **Перенаправление**: Если условия выполнены, выполняется 301 редирект

### Алгоритм перенаправления

Если текущая страница - архив И доступны посты:
    Подсчитать количество постов в цикле
    Если постов ровно 1 И перенаправление включено для этого типа архива:
        Выполнить wp_redirect() с кодом 301


## Настройки плагина

Плагин предоставляет три независимых настройки:

- **Категории**: Включить перенаправление для архивов категорий
- **Теги**: Включить перенаправление для архивов тегов
- **Даты**: Включить перенаправление для архивов дат

По умолчанию все настройки отключены.

## Локализация

Плагин поддерживает полную локализацию с использованием WordPress стандартов:
- Русский язык (ru_RU)
- Английский язык (en_US)
- Текстовый домен: `alone-post-redirector`
- Путь к переводам: `/languages`

## Системные требования

- WordPress 5.0+
- PHP 7.0+
- Поддержка постоянных ссылок (pretty permalinks)

## Безопасность

- Проверка на наличие постов перед перенаправлением
- Защита от прямого доступа к файлам
- Использование WordPress Settings API для настроек
- Санитизация входных данных
- Ролевая система доступа к админ-панели
- Использование wp_safe_redirect() вместо wp_redirect()
- Все выводы экранируются функциями esc_html__()
- Безопасная санитизация настроек

## Исправления безопасности (версия 1.0.1)

- ✅ Заменены функции `__()` на `esc_html__()` для безопасного вывода
- ✅ Заменены функции `_e()` на `esc_html_e()` в HTML-контексте
- ✅ Заменена функция `wp_redirect()` на `wp_safe_redirect()` для предотвращения открытых редиректов
- ✅ Удалена deprecated функция `load_plugin_textdomain()` (WordPress 4.6+)
- ✅ Добавлена функция `sanitize_settings()` для валидации пользовательских настроек
- ✅ Обновлен readme.txt с актуальной версией WordPress 6.8
- ✅ Сокращены теги до 5 штук согласно требованиям WordPress.org
- ✅ Добавлена лицензия GPLv2 в заголовок плагина

## Производительность

- Минимальный overhead - проверка только на архивных страницах
- Быстрое перенаправление без дополнительных запросов к БД
- Отсутствие JavaScript на фронтенде
- Кеширование настроек WordPress

## Использование

### Установка
1. Скачайте архив плагина
2. Распакуйте в папку `/wp-content/plugins/`
3. Активируйте плагин в админ-панели WordPress
4. Перейдите в **Настройки > Alone Post Redirector**
5. Включите нужные типы перенаправлений

### Настройка
- Отметьте чекбоксы для типов архивов, где нужно перенаправление
- Сохраните изменения
- Протестируйте на соответствующих архивных страницах

## Примеры использования

### Сценарий 1: Категория с одним постом
```
URL: /category/news/
Содержимое: 1 пост "Новости за неделю"
Результат: Автоматический редирект на /news/novosti-za-nedelyu/
```

### Сценарий 2: Тег с одним постом
```
URL: /tag/tutorial/
Содержимое: 1 пост "Как создать сайт"
Результат: Автоматический редирект на /tutorial/kak-sozdat-sayt/
```

### Сценарий 3: Архив даты с одним постом
```
URL: /2023/12/25/
Содержимое: 1 пост "Рождественский пост"
Результат: Автоматический редирект на /2023/12/25/rozhdestvenskiy-post/
```

## История версий

### 1.0.0 (текущая)
- Первая стабильная версия
- Базовый функционал перенаправления для архивов
- Админ-панель настроек
- Поддержка локализации (русский/английский)
- Безопасное перенаправление с HTTP 301

## Лицензия

Плагин распространяется под лицензией GPL v2 или выше.

## Автор

**Владимир Бычко**
- Website: [bychko.ru](https://bychko.ru)

## Поддержка

Для вопросов и предложений используйте:
- Репозиторий на GitHub. Создавайте Issues.
```
